<!doctype html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>dmto.me - Chat Anonima</title>
  <meta name="description" content="Chat completamente anonime senza identità - libertà assoluta">
  <meta name="theme-color" content="#000000">
  <link rel="icon" type="image/x-icon" href="./favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="./favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="./favicon-32x32.png">
  <link rel="apple-touch-icon" sizes="180x180" href="./apple-touch-icon.png">
  <link rel="manifest" href="./manifest.json">
  <link rel="stylesheet" href="./style.css">

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="./firebase-config.js"></script>
</head>
<body>
  <div class="bg-grid"></div>
  
  <main class="shell" style="display: flex; align-items: center; justify-content: center;">
    <div class="card" style="text-align: center; max-width: 400px;">
      <div class="loading-content">
        <div class="loading-logo">
          <span class="loading-dot"></span>
          <span class="loading-text">dmto.me</span>
        </div>
        <p style="color: var(--text); margin-top: 20px;">Reindirizzamento in corso...</p>
      </div>
    </div>
  </main>

  <script>
    // Router per gestire link dmto.me/username
    // Supporta sia ?u=username che #username che pathname diretto
    
    function redirectToTempChat(username) {
      if (!username || username.trim() === '') {
        // Username non valido, reindirizza alla home
        window.location.href = './index.html';
        return;
      }
      
      // Reindirizza alla chat temporanea
      window.location.href = `./temp-chat.html?user=${encodeURIComponent(username.trim())}`;
    }
    
    document.addEventListener('DOMContentLoaded', function() {
      let username = null;
      
      // Metodo 1: Parametro URL ?u=username
      const urlParams = new URLSearchParams(window.location.search);
      username = urlParams.get('u');
      
      // Metodo 2: Hash #username
      if (!username && window.location.hash) {
        username = window.location.hash.substring(1); // Rimuove il #
      }
      
      // Metodo 3: Pathname diretto (se configurato con rewrite rules)
      // Es: /user/username o /username
      if (!username) {
        const pathParts = window.location.pathname.split('/').filter(p => p);
        // Cerca 'user' nella path e prende il prossimo segmento
        const userIndex = pathParts.indexOf('user');
        if (userIndex !== -1 && pathParts[userIndex + 1]) {
          username = pathParts[userIndex + 1];
        } else if (pathParts.length > 0 && pathParts[0] !== 'app' && pathParts[0] !== 'user') {
          // Se non c'è 'user', prende l'ultimo segmento come username
          username = pathParts[pathParts.length - 1];
        }
      }
      
      // Reindirizza
      redirectToTempChat(username);
    });
  </script>
</body>
</html>
